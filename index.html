<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>3416 æˆ°ç•¥çµ‚ç«¯ Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: -apple-system, system-ui, sans-serif; -webkit-font-smoothing: antialiased; }
        .mono { font-family: 'SF Mono', 'JetBrains Mono', monospace; }
        .active-btn:active { transform: scale(0.96); transition: 0.1s; }
        input, select { -webkit-appearance: none; border-radius: 1rem; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 pb-10">

    <div class="bg-slate-900 text-white p-6 rounded-b-[2.5rem] shadow-xl">
        <div class="flex justify-between items-center mb-2 text-[10px] font-bold opacity-50 uppercase tracking-widest">
            <span>Portfolio Status</span>
            <span id="lastUpdate">--:--</span>
        </div>
        <div class="flex items-baseline gap-2 mb-4">
            <h1 id="totalEquity" class="text-4xl font-black mono">$1,000,000</h1>
            <span id="totalRoi" class="text-emerald-400 font-bold text-sm">+0.0%</span>
        </div>
        <div class="grid grid-cols-2 gap-4 border-t border-white/10 pt-4">
            <div>
                <p class="text-[10px] opacity-50 uppercase font-bold text-emerald-300">æµå‹•ç¾é‡‘</p>
                <p id="cashBal" class="text-lg font-bold mono">$1,000,000</p>
            </div>
            <div class="text-right">
                <p class="text-[10px] opacity-50 uppercase font-bold text-rose-300">æœ€å¤§å›æ’¤</p>
                <p id="maxDD" class="text-lg font-bold mono">0.0%</p>
            </div>
        </div>
    </div>

    <div class="px-4 -mt-4 space-y-4">
        
        <div class="bg-white rounded-3xl p-4 shadow-lg border border-slate-100 grid grid-cols-2 gap-2 h-48">
            <div class="flex flex-col border-r border-slate-50 pr-2">
                <h3 class="text-[9px] font-black text-slate-400 uppercase mb-2 text-center tracking-tighter">è³‡ç”¢è¶¨å‹¢ (Trend)</h3>
                <div class="flex-grow"><canvas id="trendChart"></canvas></div>
            </div>
            <div class="flex flex-col pl-2">
                <h3 class="text-[9px] font-black text-slate-400 uppercase mb-2 text-center tracking-tighter">è³‡ç”¢ä½”æ¯” (Allocation)</h3>
                <div class="flex-grow relative">
                    <canvas id="allocChart"></canvas>
                </div>
            </div>
        </div>

        <div id="decisionCard" class="bg-white rounded-2xl p-4 shadow-md border border-slate-100 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <span id="decisionEmoji" class="text-xl">â˜•</span>
                <div>
                    <h2 id="decisionTitle" class="font-bold text-slate-800 text-[11px] uppercase">ç­‰å¾…åˆ†æ</h2>
                    <p id="decisionText" class="text-[9px] text-slate-500">è¼¸å…¥å¸‚åƒ¹å¾Œè©•ä¼°...</p>
                </div>
            </div>
            <div class="text-right">
                <p class="text-[8px] font-bold text-slate-400 uppercase">é ä¼°å¹´æ¯ç‡</p>
                <span id="yieldVal" class="text-lg font-black mono text-emerald-600">--%</span>
            </div>
        </div>

        <div class="bg-white rounded-[2rem] p-5 shadow-sm border border-slate-100 space-y-3">
            
            <div class="flex items-center gap-2 bg-emerald-50 p-4 rounded-2xl border border-emerald-100">
                <span class="text-xs font-bold text-emerald-700">æ¯æœˆæ´¾æ¯ $</span>
                <input type="number" id="divSetting" value="0.14" step="0.01" oninput="updateDecision()" class="w-full bg-transparent font-black mono text-emerald-700 outline-none text-right text-lg">
                <span class="text-[9px] text-emerald-600 font-bold opacity-50 italic">å¯æ‰‹å‹•ä¿®æ”¹</span>
            </div>

            <select id="bucket" class="w-full p-4 bg-slate-50 rounded-2xl font-bold text-sm border-0 uppercase tracking-tighter">
                <option value="b1">ä»½é¡ 1: é•·ç·šæ ¸å¿ƒ (40%)</option>
                <option value="b2">ä»½é¡ 2: çŸ­ç·šæ³¢æ®µ (30%)</option>
                <option value="b3">ä»½é¡ 3: æ’ˆåº•å„²å‚™ (30%)</option>
            </select>

            <div class="grid grid-cols-2 gap-2 text-center">
                <div class="bg-slate-50 rounded-2xl p-2 relative">
                    <span class="text-[8px] font-bold text-slate-400 uppercase absolute top-2 left-0 right-0">ç•¶å‰å¸‚åƒ¹</span>
                    <input type="number" id="price" value="10.60" step="0.01" oninput="updateDecision()" class="w-full pt-4 bg-transparent font-mono font-bold text-center outline-none">
                </div>
                <div class="bg-slate-50 rounded-2xl p-2 relative">
                    <span class="text-[8px] font-bold text-slate-400 uppercase absolute top-2 left-0 right-0">ä¸‹æ³¨è‚¡æ•¸</span>
                    <input type="number" id="shares" value="10000" class="w-full pt-4 bg-transparent font-mono font-bold text-center outline-none">
                </div>
            </div>

            <div class="grid grid-cols-2 gap-2 pt-1">
                <button onclick="trade('BUY')" class="active-btn bg-slate-900 text-white font-black py-4 rounded-2xl shadow-lg text-xs uppercase">è²·å…¥é€²å ´</button>
                <button onclick="trade('SELL')" class="active-btn bg-white border-2 border-slate-900 font-bold py-4 rounded-2xl text-xs uppercase">æ²½å‡ºç²åˆ©</button>
            </div>
            <button onclick="collectDiv()" class="active-btn w-full bg-emerald-500 text-white font-black py-4 rounded-2xl shadow-md flex justify-center items-center gap-2">
                <span>ğŸ’° é ˜å–æœ¬æœˆè‚¡æ¯</span>
            </button>
        </div>

        <div class="bg-white rounded-[2rem] shadow-sm border border-slate-100 overflow-hidden mb-10">
            <div class="px-6 py-4 bg-slate-50 border-b flex justify-between items-center">
                <span class="text-[10px] font-black uppercase text-slate-400 tracking-widest">äº¤æ˜“æ—¥è¨˜ç°¿</span>
                <button onclick="resetData()" class="text-[9px] font-bold text-rose-400 uppercase">é‡è¨­ç³»çµ±</button>
            </div>
            <div id="logBody" class="divide-y text-[10px] max-h-60 overflow-y-auto"></div>
        </div>
    </div>

    <script>
        let state = JSON.parse(localStorage.getItem('3416_v4_state')) || {
            cash: 1000000,
            holding: { b1: 0, b2: 0, b3: 0 },
            peak: 1000000,
            history: [1000000],
            logs: []
        };

        let trendChart, allocChart;

        function saveState() { localStorage.setItem('3416_v4_state', JSON.stringify(state)); }
        function resetData() { if(confirm("ç¢ºå®šé‡è¨­æ‰€æœ‰æ•¸æ“šï¼Ÿ")) { localStorage.removeItem('3416_v4_state'); location.reload(); } }

        function initCharts() {
            trendChart = new Chart(document.getElementById('trendChart').getContext('2d'), {
                type: 'line',
                data: { labels: state.history.map((_,i)=>i), datasets: [{ data: state.history, borderColor: '#0f172a', backgroundColor: 'rgba(15,23,42,0.05)', fill: true, tension: 0.4, pointRadius: 0 }] },
                options: { maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } } }
            });

            allocChart = new Chart(document.getElementById('allocChart').getContext('2d'), {
                type: 'doughnut',
                data: { labels: ['B1', 'B2', 'B3', 'Cash'], datasets: [{ data: [0,0,0,1], backgroundColor: ['#3b82f6', '#f59e0b', '#f43f5e', '#f1f5f9'], borderWidth: 0 }] },
                options: { maintainAspectRatio: false, cutout: '75%', plugins: { legend: { display: false } } }
            });
            updateUI();
        }

        function updateDecision() {
            const p = parseFloat(document.getElementById('price').value) || 10.6;
            const currentDiv = parseFloat(document.getElementById('divSetting').value) || 0.14;
            const y = ((currentDiv * 12) / p * 100).toFixed(1);
            document.getElementById('yieldVal').innerText = y + "%";
            
            const card = document.getElementById('decisionCard');
            const title = document.getElementById('decisionTitle');
            const text = document.getElementById('decisionText');
            const emoji = document.getElementById('decisionEmoji');

            if (y >= 18.5) {
                card.classList.add('bg-emerald-50', 'border-emerald-500');
                title.innerText = "ğŸš¨ çµ•ä½³æ©Ÿæœƒ (ä»½é¡3)";
                text.innerText = "æ¥µé«˜æ¯å€é–“ï¼Œå»ºè­°åŠ å€‰";
                emoji.innerText = "ğŸŒŸ";
            } else if (y >= 16.5) {
                card.classList.add('bg-blue-50', 'border-blue-500');
                title.innerText = "ğŸ“ˆ æ³¢æ®µæ“ä½œ (ä»½é¡2)";
                text.innerText = "åˆç†æ¯ç‡ï¼Œé©åˆæ³¢æ®µ";
                emoji.innerText = "âœ…";
            } else {
                card.className = "bg-white rounded-2xl p-4 shadow-md border border-slate-100 flex justify-between items-center transition-all";
                title.innerText = "ğŸ§˜ ç©©å®šæ”¶æ¯ (ä»½é¡1)";
                text.innerText = "è€å¿ƒæŒè‚¡ï¼ŒæŒ‰æœˆé ˜æ¯";
                emoji.innerText = "â˜•";
            }
        }

        function trade(type) {
            const p = parseFloat(document.getElementById('price').value);
            const s = parseInt(document.getElementById('shares').value);
            const b = document.getElementById('bucket').value;
            const amt = p * s;
            if (type === 'BUY') {
                if (state.cash < amt) return alert("æµå‹•ç¾é‡‘ä¸è¶³!");
                state.cash -= amt; state.holding[b] += s;
                log(`è²·å…¥ ${s.toLocaleString()}è‚¡ (${b})`, -amt);
            } else {
                if (state.holding[b] < s) return alert("æŒå€‰ä¸è¶³!");
                state.cash += amt; state.holding[b] -= s;
                log(`æ²½å‡º ${s.toLocaleString()}è‚¡ (${b})`, amt);
            }
            updateUI();
            saveState();
        }

        function collectDiv() {
            const currentDiv = parseFloat(document.getElementById('divSetting').value);
            const totalS = state.holding.b1 + state.holding.b2 + state.holding.b3;
            if (totalS <= 0) return alert("ç•¶å‰æ²’æœ‰æŒå€‰");
            const div = totalS * currentDiv;
            state.cash += div;
            log(`æ”¶æ¯ ${totalS.toLocaleString()}è‚¡ (@$${currentDiv})`, div);
            updateUI();
            saveState();
        }

        function log(msg, amt) {
            state.logs.unshift({ time: new Date().toLocaleTimeString().slice(0,5), msg, amt });
            if (state.logs.length > 50) state.logs.pop();
            renderLogs();
        }

        function renderLogs() {
            document.getElementById('logBody').innerHTML = state.logs.map(l => `
                <div class="p-4 flex justify-between items-center bg-white px-6 border-b border-slate-50 last:border-0">
                    <span class="text-slate-400 mono text-[8px]">${l.time}</span>
                    <span class="font-bold text-slate-700">${l.msg}</span>
                    <span class="font-black mono ${l.amt>=0?'text-emerald-500':'text-slate-900'}">${l.amt>=0?'+':''}${Math.round(l.amt).toLocaleString()}</span>
                </div>
            `).join('');
        }

        function updateUI() {
            const p = parseFloat(document.getElementById('price').value) || 10.6;
            const v1 = state.holding.b1 * p;
            const v2 = state.holding.b2 * p;
            const v3 = state.holding.b3 * p;
            const eq = state.cash + v1 + v2 + v3;
            const roi = ((eq - 1000000) / 1000000 * 100).toFixed(1);
            if (eq > state.peak) state.peak = eq;
            const dd = ((state.peak - eq) / state.peak * 100).toFixed(1);

            document.getElementById('totalEquity').innerText = "$" + Math.round(eq).toLocaleString();
            document.getElementById('totalRoi').innerText = (roi >= 0 ? "+" : "") + roi + "%";
            document.getElementById('cashBal').innerText = "$" + Math.round(state.cash).toLocaleString();
            document.getElementById('maxDD').innerText = dd + "%";
            document.getElementById('lastUpdate').innerText = new Date().toLocaleTimeString().slice(0,5);

            state.history.push(eq);
            if(state.history.length > 30) state.history.shift();
            
            trendChart.update();
            allocChart.data.datasets[0].data = [v1, v2, v3, state.cash];
            allocChart.update();
            renderLogs();
            updateDecision();
        }

        window.onload = initCharts;
    </script>
</body>
</html>